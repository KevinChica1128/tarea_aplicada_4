plot(density(theta1))
x11()
plot(density(theta1))
x11()
plot(density(theta1))
lines(density(dnorm(theta1,xbarra,sqrt(varianza))))
x11()
plot(density(theta1))
lines(density(w))
x11()
plot(density(theta1))
lines(density(X))
x11()
plot(density(theta1),col="red",lty=2,lwd=3)
lines(density(X))
x11()
plot(density(theta1),col="red",lty=2,lwd=3)
lines(density(X))
x11()
plot(density(theta1),col="red",lty=2,lwd=2)
lines(density(X))
x11()
plot(density(theta1),col="red",lty=2,lwd=2)
lines(density(X),lwd=2)
#Ejemplo 3
#----------------------------------------#
#N=197
m=10000
N=197
y1=125
y2=18
y3=20
y4=34
a=b=1
h<-function(x){((2+x)^y1)*((1-x)^(y2+y3+b-1))*x^(y4+a-1)}
#exacta
integrate(h,0,1)
Espteor<-integrate(h,0,1) #0.6228062
Esp2teor<-integrate(h,0,1) #0.3904824
Varteori<-0.3904824-(0.6228062)^2
#Función de importancia Beta
p<-rbeta(m,1,1)
w<-h(p)/dbeta(p,1,1)
E<-(1/sum(w))*(sum(w*p)) #0.6226815
EB2<-(1/sum(w))*(sum(w*(p^2))) #0.3902821 #E(x^2)
VB<-EB2-(E^2)
#Función de importancia normal
p1<-rnorm(m,0.6268,0.002649)
w1<-h(p1)/dnorm(p1,0.6268,0.002649)
E1<-(1/sum(w1))*(sum(w1*p1)) #0.6255348
EN2<-(1/sum(w1))*(sum(w1*(p1^2))) #0.3913354 #E(x^2)
VN<-EN2-(E1^2) #0.000032416
x11()
plot(density(h(x)))
x11()
plot(density(h(p)))
x11()
plot(h(p),p)
x11()
plot(p,h(p))
x11()
plot(p,h(p))
lines(p1,h(p1))
x11()
plot(p,h(p))
lines(p1,h(p1),col="red")
x11()
plot(density(h(p)))
x11()
plot(density(h(p1)))
x11()
plot(theta1,dnorm(theta1,xbarra,sqrt(varianza)))
x11()
plot(density(theta1),col="red",lty=2,lwd=2)
lines(density(X),lwd=2)
x11()
plot(density(p),col="red",lty=2,lwd=2)
lines(density(p1),lwd=2)
#Función de importancia Beta
p<-rbeta(m,1,1)
w<-h(p)/dbeta(p,1,1)
E<-(1/sum(w))*(sum(w*p)) #0.6226815
EB2<-(1/sum(w))*(sum(w*(p^2))) #0.3902821 #E(x^2)
VB<-EB2-(E^2)
#Función de importancia normal
p1<-rnorm(m,0.6268,0.002649)
w1<-h(p1)/dnorm(p1,0.6268,0.002649)
E1<-(1/sum(w1))*(sum(w1*p1)) #0.6255348
EN2<-(1/sum(w1))*(sum(w1*(p1^2))) #0.3913354 #E(x^2)
VN<-EN2-(E1^2) #0.000032416
x11()
plot(density(p),col="red",lty=2,lwd=2)
lines(density(p1),lwd=2)
dnorm(p1,0.6268,0.002649)
x11()
plot(dnorm(p1,0.6268,0.002649))
x11()
plot(density(dnorm(p1,0.6268,0.002649)))
z<-function(x){((2+x)^125)*((1-x)^(18+20+1-1))*(x^(34+1-1)}
integrate(z,0,1)
z<-function(x){((2+x)^125)*((1-x)^(18+20+1-1))*(x^(34+1-1)}
z<-function(x){((2+x)^y1)*((1-x)^(y2+y3+b-1))*x^(y4+a-1)}
integrate(z,0,1)
z<-function(x){(1/2.357695e+28)*((2+x)^y1)*((1-x)^(y2+y3+b-1))*x^(y4+a-1)}
integrate(z,0,1)
tetas<-rnorm(1000,0.6268,0.002649)
x11()
plot(tetas,z(tetas))
x11()
plot(tetas)
x11()
plot(density(tetas))
tetas2<-rbeta(1000,1,1)
x11()
plot(density(tetas2))
z1<-function(x){((2+x)^y1)*((1-x)^(y2+y3+b-1))*x^(y4+a-1)}
x11()
plot(tetas,z1(tetas))
x11()
plot(tetas,z(tetas))
x11()
plot(tetas,z1(tetas))
x11()
plot(tetas,z(tetas))
x11()
plot(density(tetas))
x11()
plot(tetas,z1(tetas),type="l")
x11()
plot(tetas,z1(tetas),type="c")
WWW<-z1(tetas)/dnorm(tetas,0.6268,0.002649)
WWW
x11()
plot(density(www))
x11()
plot(density(WWW))
x11()
plot(density(WWW),xlim=c(0,1))
x11()
plot(density(WWW))
x11()
plot(density(WWW),xlim=c(0,1000000000))
x11()
plot(density(tetas))
x11()
plot(tetas2,z1(tetas2)
lines(density(tetas))
x11()
plot(tetas2,z1(tetas2))
lines(density(tetas))
#Ejemplo 3
#----------------------------------------#
#N=197
m=10000
N=197
y1=125
y2=18
y3=20
y4=34
a=b=1
h<-function(x){((2+x)^y1)*((1-x)^(y2+y3+b-1))*x^(y4+a-1)}
#exacta
integrate(h,0,1)
Espteor<-integrate(h,0,1) #0.6228062
Esp2teor<-integrate(h,0,1) #0.3904824
Varteori<-0.3904824-(0.6228062)^2
#Función de importancia Beta
p<-rbeta(m,1,1)
w<-h(p)/dbeta(p,1,1)
E<-(1/sum(w))*(sum(w*p)) #0.6226815
EB2<-(1/sum(w))*(sum(w*(p^2))) #0.3902821 #E(x^2)
VB<-EB2-(E^2)
#Función de importancia normal
p1<-rnorm(m,0.6268,0.002649)
w1<-h(p1)/dnorm(p1,0.6268,0.002649)
E1<-(1/sum(w1))*(sum(w1*p1)) #0.6255348
EN2<-(1/sum(w1))*(sum(w1*(p1^2))) #0.3913354 #E(x^2)
VN<-EN2-(E1^2) #0.000032416
x11()
plot(density(p),col="red",lty=2,lwd=2)
lines(density(p1),lwd=2)
x11()
plot(p,h(p))
lines(density(p1),lwd=2)
x11()
plot(p,h(p))
lines(plot(p1,h(p1)))
x11()
plot(density(theta1),col="red",lty=2,lwd=2)
lines(density(X),lwd=2)
x11()
plot(density(p),col="red",lty=2,lwd=2)
lines(density(p1),lwd=2)
cadata <- read.csv("~/GitHub/tarea_aplicada_4/cadata.txt", sep="")
## El número aleatorio generado fue 15529 ##
# Eliminamos las filas que no necesitamos, nos quedamos con las filas desde la 15529 hasta la 16029 #
cadata<- cadata[-c(1:15528,16029:20640),]
#Ajuste del modelo completo:
Regresion<- lm(cadata$Valor_mediano_de_la_casa ~ cadata$Ingreso_mediano+cadata$Edad_mediana_de_la_vivienda+cadata$Total_de_habitaciones+cadata$Total_de_dormitorios+cadata$Poblacion+cadata$Hogares)
summary(Regresion)$sigma^2
#Valors ajustados y residuales del modelo:
yajustados<-fitted(Regresion)
residuales<-residuals(Regresion)
residuales
#Matriz de correlaciones:
X = cbind(Ingreso=cadata$Ingreso_mediano,Edad=cadata$Edad_mediana_de_la_vivienda,Habitaciones=cadata$Total_de_habitaciones,
Dormitorios=cadata$Total_de_dormitorios,Poblacion=cadata$Poblacion,Hogares=cadata$Hogares)
R = cor(X)
R
#La matriz X* (reescalada) es:
x1<-cadata$Ingreso_mediano
x2<-cadata$Edad_mediana_de_la_vivienda
x3<-cadata$Total_de_habitaciones
x4<-cadata$Total_de_dormitorios
x5<-cadata$Poblacion
x6<-cadata$Hogares
X1<-(x1-mean(x1))/sqrt(sum(x1^2)-(length(x1)*mean(x1)^2))
X2<-(x2-mean(x2))/sqrt(sum(x2^2)-(length(x2)*mean(x2)^2))
X3<-(x3-mean(x3))/sqrt(sum(x3^2)-(length(x3)*mean(x3)^2))
X4<-(x4-mean(x4))/sqrt(sum(x4^2)-(length(x4)*mean(x4)^2))
X5<-(x5-mean(x5))/sqrt(sum(x5^2)-(length(x5)*mean(x5)^2))
X6<-(x6-mean(x6))/sqrt(sum(x6^2)-(length(x6)*mean(x6)^2))
Xr<-cbind(X1,X2,X3,X4,X5,X6)
#X*t X en forma de correlacion es:
Rr<-t(Xr)%*%Xr
#Estimación por PCR (Estandarizados):
y<-cadata$Valor_mediano_de_la_casa
Y<-(y-mean(y))/sqrt(sum(y^2)-(length(y)*mean(y)^2))
modeloreescalado<-lm(Y~X1+X2+X3+X4+X5+X6)
modeloreescalado$coefficients
summary(modeloreescalado)
T<-eigen(Rr)$vectors
Z<-Xr%*%T
A<-t(Z)%*%Z
alfae<-solve(A)%*%t(Z)%*%Y
alfaec<-c(1,1,1,0,0,0)*alfae
Betaest<-T%*%alfaec
mean(Y)
#Estimación por PCR(escala original)
xbarra<-c(mean(x1),mean(x2),mean(x3),mean(x4),mean(x5),mean(x6))
Betaori<-c()
Betaori[1]=Betaest[1]*(sd(y)/sd(x1))
Betaori[2]=Betaest[2]*(sd(y)/sd(x2))
Betaori[3]=Betaest[3]*(sd(y)/sd(x3))
Betaori[4]=Betaest[4]*(sd(y)/sd(x4))
Betaori[5]=Betaest[5]*(sd(y)/sd(x5))
Betaori[6]=Betaest[6]*(sd(y)/sd(x6))
Beta0ori=mean(y)-(t(Betaori)%*%xbarra)
betas<-c(Beta0ori,Betaori)
betas
sigma=(1/(500-7))*(t(y)%*%y-(t(betas)%*%t(X_1col)%*%y))
#varianza MCO (datos normales):
X_1col=cbind(1,X)
sigma=(1/(500-7))*(t(y)%*%y-(t(betas)%*%t(X_1col)%*%y))
sqrt(sigma)
sigma
var_lm1=(1/(500-7))*((t(y)%*%y)-(t(Regresion$coefficients)%*%t(X_1col)%*%y))
var_lm1
summary(Regresion)$sigma^2
Vbetalm=solve(t(X_1col)%*%X_1col)*6724487923
Vbetalm
summary(Regresion)$sigma^2
sigma
#R2 de os dos modelos (PCR y MCO):
xdtyd<-t(xr)%*%xr
#R2 de os dos modelos (PCR y MCO):
X1d<-(x1-mean(x1))
X2d<-(x2-mean(x2))
X3d<-(x3-mean(x3))
X4d<-(x4-mean(x4))
X5d<-(x5-mean(x5))
X6d<-(x6-mean(x6))
Xd<-cbind(X1d,X2d,X3d,X4d,X5d,X6d)
xdtyd<-t(Xd)%*%Xd
xdtyd
yd<-(y-mean(y))
yd<-(y-mean(y))
xdtyd<-t(Xd)%*%Xd
xdtyd<-t(Xd)%*%yd
xdtyd
xdtyd
xdtxd<-t(Xd)%*%Xd
xdtyd<-t(Xd)%*%yd
xdtxd
xdtyd
SCRd<-
SCTd<-t(yd)%*%yd
SCTd
solve(t(Xd)%*%Xd)%*%t(Xd)%*%yd
summary(Regresion)
B1M<-solve(t(Xd)%*%Xd)%*%t(Xd)%*%yd
Betaest
Betaori
B1P<-Betaori
SCRdM<-t(B1M)%*%t(Xd)%*%yd
SCRdP<-t(B1P)%*%t(Xd)%*%yd
SCRdM
SCRdP
R2M<-SCRdM/SCTd
R2P<-SCRdP/SCTd
R2M
R2P
Betaest<-T%*%alfae
Betaori[1]=Betaest[1]*(sd(y)/sd(x1))
Betaori[2]=Betaest[2]*(sd(y)/sd(x2))
Betaori[3]=Betaest[3]*(sd(y)/sd(x3))
Betaori[4]=Betaest[4]*(sd(y)/sd(x4))
Betaori[5]=Betaest[5]*(sd(y)/sd(x5))
Betaori[6]=Betaest[6]*(sd(y)/sd(x6))
B1M<-solve(t(Xd)%*%Xd)%*%t(Xd)%*%yd
B1P<-Betaori
SCRdM<-t(B1M)%*%t(Xd)%*%yd
SCRdP<-t(B1P)%*%t(Xd)%*%yd
SCTd<-t(yd)%*%yd
R2M<-SCRdM/SCTd
R2P<-SCRdP/SCTd
R2M
R2P
alfaec<-c(1,1,1,0,0,0)*alfaec
Betaest<-T%*%alfae
Betaori[1]=Betaest[1]*(sd(y)/sd(x1))
Betaori[2]=Betaest[2]*(sd(y)/sd(x2))
Betaori[3]=Betaest[3]*(sd(y)/sd(x3))
Betaori[4]=Betaest[4]*(sd(y)/sd(x4))
Betaori[5]=Betaest[5]*(sd(y)/sd(x5))
Betaori[6]=Betaest[6]*(sd(y)/sd(x6))
SCRdM<-t(B1M)%*%t(Xd)%*%yd
SCRdP<-t(B1P)%*%t(Xd)%*%yd
SCTd<-t(yd)%*%yd
R2M<-SCRdM/SCTd
R2P<-SCRdP/SCTd
R2M
R2P
B1P<-Betaori
SCRdM<-t(B1M)%*%t(Xd)%*%yd
SCRdP<-t(B1P)%*%t(Xd)%*%yd
SCTd<-t(yd)%*%yd
R2M<-SCRdM/SCTd
R2P<-SCRdP/SCTd
R2P
R2M<-SCRdM/SCTd
R2M
R2P<-SCRdP/SCTd
R2P
alfaec<-c(1,1,1,0,0,0)*alfae
Betaest<-T%*%alfaec
Betaori<-c()
Betaori[1]=Betaest[1]*(sd(y)/sd(x1))
Betaori[2]=Betaest[2]*(sd(y)/sd(x2))
Betaori[3]=Betaest[3]*(sd(y)/sd(x3))
Betaori[4]=Betaest[4]*(sd(y)/sd(x4))
Betaori[5]=Betaest[5]*(sd(y)/sd(x5))
Betaori[6]=Betaest[6]*(sd(y)/sd(x6))
Beta0ori=mean(y)-(t(Betaori)%*%xbarra)
betas<-c(Beta0ori,Betaori)
B1P<-Betaori
SCRdM<-t(B1M)%*%t(Xd)%*%yd
SCRdP<-t(B1P)%*%t(Xd)%*%yd
SCTd<-t(yd)%*%yd
R2M<-SCRdM/SCTd
R2P<-SCRdP/SCTd
R2P
R2M
#Ejemplo 2:
funcion<-function(x){(x^9)*((1-x)^3)}
funcion2exacta<-function(x){(gamma(14)/(gamma(10)*gamma(4)))*(x^9)*((1-x)^3)*(x^2)}
integrate(funcion,0,1) #Constante de integración
integrate(funcion2exacta,0,1) #Integral de la densidad completa (=1)
Eteorica<-integrate(funcion2exacta,0,1)  #0.7142857
E2teorica<-integrate(funcion2exacta,0,1) #0.5238095
Vteorica<-0.5238095-(0.7142857^2) #Resultado: 0.01360544
teta2<-runif(N) #Funcion de importancia U(0,1)
w1<-funcion(teta2)/dunif(teta2,0,1)
E1<-(1/sum(w1))*(sum(w1*teta2))  #Esperanza estimada  0.7148448
E21<-(1/sum(w1))*(sum(w1*(teta2^2))) #0.5247885
V1<-E21-(E1^2) #Varianza estimada 0.01378547
teta22<-rbeta(N,8.25,2.75) #Función de importancia Beta(8.25,2.75)
w12<-funcion(teta22)/dbeta(teta22,8.25,2.75)
#Muestreo por importancia Ejemplos:
#Ejemplo 1:
N=10000
#Ejemplo 2:
funcion<-function(x){(x^9)*((1-x)^3)}
funcion2exacta<-function(x){(gamma(14)/(gamma(10)*gamma(4)))*(x^9)*((1-x)^3)*(x^2)}
integrate(funcion,0,1) #Constante de integración
integrate(funcion2exacta,0,1) #Integral de la densidad completa (=1)
Eteorica<-integrate(funcion2exacta,0,1)  #0.7142857
E2teorica<-integrate(funcion2exacta,0,1) #0.5238095
Vteorica<-0.5238095-(0.7142857^2) #Resultado: 0.01360544
teta2<-runif(N) #Funcion de importancia U(0,1)
w1<-funcion(teta2)/dunif(teta2,0,1)
E1<-(1/sum(w1))*(sum(w1*teta2))  #Esperanza estimada  0.7148448
E21<-(1/sum(w1))*(sum(w1*(teta2^2))) #0.5247885
V1<-E21-(E1^2) #Varianza estimada 0.01378547
teta22<-rbeta(N,8.25,2.75) #Función de importancia Beta(8.25,2.75)
w12<-funcion(teta22)/dbeta(teta22,8.25,2.75)
E12<-(1/sum(w12))*(sum(w12*teta22))  #Esperanza estimada 0.7142896
E212<-(1/sum(w12))*(sum(w12*(teta22^2))) #Varianza estimada 0.5238356
V12<-E212-(E12^2) #0.01362596
#Gráfica comparativa:
x11()
plot(density(teta22),col="chartreuse4",ylab=expression(paste("h(",theta,"|y)"))
,xlab = expression(theta),
main = "Aproximación distribuciones a posteriori",lty=5,lwd=2)
curve(funcion2exacta,0,1,10000,add=TRUE,lwd=3)
lines(density(teta2),lty=2,lwd=2,col="Red")
legend("topleft",legend=c("Exacta","Uniforme","Beta"),
col=c("Black","Red","chartreuse4"),lty=c(1,2,5))
x11()
plot(density(theta1),col="red",lty=2,lwd=2,ylab=expression(paste("h(",theta,"|y)"))
,xlab = expression(theta),
main = "Aproximación distribuciones a posteriori")
lines(density(X),lwd=2)
legend("topright",legend=c("Exacta","T-Student"),
col=c("Black","Red"),lty=c(1,2))
#Muestreo por importancia Ejemplos:
#Ejemplo 1:
N=10000
X<-rnorm(N)   #Esto se hizo para tener la media y la varianza teorica
xbarra=mean(X) #Media teorica
varianza=1/N   #Varianza teorica
theta1<-rt(N,N)  #Tetas generados a partir de la función de importancia t de student
w<-dnorm(theta1,xbarra,sqrt(varianza))/dt(theta1,N) #Pesos
E<-(1/sum(w))*(sum(w*theta1))  #Esperanza estimada  0.01375921
E2<-(1/sum(w))*(sum(w*(theta1^2))) #Esperanza^2 estimada 0.0002915643
V<-E2-(E^2) #Varianza 0.0001022485
#Gráfica comparativa:
x11()
plot(density(theta1),col="red",lty=2,lwd=2,ylab=expression(paste("h(",theta,"|y)"))
,xlab = expression(theta),
main = "Aproximación distribuciones a posteriori")
lines(density(X),lwd=2)
legend("topright",legend=c("Exacta","T-Student"),
col=c("Black","Red"),lty=c(1,2))
theta1<-rt(N,2)  #Tetas generados a partir de la función de importancia t de student
x11()
plot(density(theta1),col="red",lty=2,lwd=2,ylab=expression(paste("h(",theta,"|y)"))
,xlab = expression(theta),
main = "Aproximación distribuciones a posteriori")
lines(density(X),lwd=2)
legend("topright",legend=c("Exacta","T-Student"),
col=c("Black","Red"),lty=c(1,2))
theta1<-rt(N,2)  #Tetas generados a partir de la función de importancia t de student
x11()
plot(density(theta1),col="red",lty=2,lwd=2,ylab=expression(paste("h(",theta,"|y)"))
,xlab = expression(theta),
main = "Aproximación distribuciones a posteriori")
lines(density(X),lwd=2)
legend("topright",legend=c("Exacta","T-Student"),
col=c("Black","Red"),lty=c(1,2))
theta1<-rt(N,100)  #Tetas generados a partir de la función de importancia t de student
x11()
plot(density(theta1),col="red",lty=2,lwd=2,ylab=expression(paste("h(",theta,"|y)"))
,xlab = expression(theta),
main = "Aproximación distribuciones a posteriori")
lines(density(X),lwd=2)
legend("topright",legend=c("Exacta","T-Student"),
col=c("Black","Red"),lty=c(1,2))
theta1<-rt(N,N)  #Tetas generados a partir de la función de importancia t de student
x11()
plot(density(theta1),col="red",lty=2,lwd=2,ylab=expression(paste("h(",theta,"|y)"))
,xlab = expression(theta),
main = "Aproximación distribuciones a posteriori")
lines(density(X),lwd=2)
legend("topright",legend=c("Exacta","T-Student"),
col=c("Black","Red"),lty=c(1,2))
xbarra
#Muestreo por importancia Ejemplos:
#Ejemplo 1:
N=10000
X<-rnorm(N)   #Esto se hizo para tener la media y la varianza teorica
xbarra=mean(X) #Media teorica
varianza=1/N   #Varianza teorica
xbarra
varianza
theta1<-rt(N,N)  #Tetas generados a partir de la función de importancia t de student
w<-dnorm(theta1,xbarra,sqrt(varianza))/dt(theta1,N) #Pesos
E<-(1/sum(w))*(sum(w*theta1))  #Esperanza estimada  0.01375921
E2<-(1/sum(w))*(sum(w*(theta1^2))) #Esperanza^2 estimada 0.0002915643
E
X<-rnorm(N)   #Esto se hizo para tener la media y la varianza teorica
xbarra=mean(X) #Media teorica
xbarra
X<-rnorm(N)   #Esto se hizo para tener la media y la varianza teorica
xbarra=mean(X) #Media teorica
xbarra
X<-rnorm(N)   #Esto se hizo para tener la media y la varianza teorica
xbarra
X<-rnorm(N)   #Esto se hizo para tener la media y la varianza teorica
xbarra=mean(X) #Media teorica
xbarra
X<-rnorm(N)   #Esto se hizo para tener la media y la varianza teorica
xbarra=mean(X) #Media teorica
xbarra
X<-rnorm(N)   #Esto se hizo para tener la media y la varianza teorica
xbarra=mean(X) #Media teorica
xbarra
theta1<-rt(N,N)  #Tetas generados a partir de la función de importancia t de student
w<-dnorm(theta1,xbarra,sqrt(varianza))/dt(theta1,N) #Pesos
E<-(1/sum(w))*(sum(w*theta1))  #Esperanza estimada  0.01375921
E
varianza
E2<-(1/sum(w))*(sum(w*(theta1^2))) #Esperanza^2 estimada 0.0002915643
E2
V<-E2-(E^2) #Varianza 0.0001022485
V
xdtxd<-t(Xd)%*%Xd
xdtxd
xdtyd
R2M
R2P
summary(Regresion)
